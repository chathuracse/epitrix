<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overview of the epitrix package • epitrix</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Overview of the epitrix package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epitrix</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/epitrix.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/reconhub/epitrix/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Overview of the epitrix package</h1>
                        <h4 class="author">Thibaut Jombart</h4>
            
            <h4 class="date">2018-04-18</h4>
      
      <small>Source: <a href="https://github.com/reconhub/epitrix//blob/master/vignettes/epitrix.Rmd"><code>vignettes/epitrix.Rmd</code></a></small>
      <div class="hidden name"><code>epitrix.Rmd</code></div>

    </div>

    
    
<p><em>epitrix</em> implements small helper functions usefull in infectious disease modelling and epidemics analysis. This vignette provides a quick overview of the package’s features.</p>
<div id="what-does-it-do" class="section level1">
<h1 class="hasAnchor">
<a href="#what-does-it-do" class="anchor"></a>What does it do?</h1>
<p>The main features of the package include:</p>
<ul>
<li><p><strong><code>gamma_shapescale2mucv</code></strong>: convert shape and scale of a Gamma distribution to mean and CV</p></li>
<li><p><strong><code>gamma_mucv2shapescale</code></strong>: convert mean and CV of a Gamma distribution to shape and scale</p></li>
<li><p><strong><code>gamma_log_likelihood</code></strong>: Gamma log-likelihood using mean and CV</p></li>
<li><p><strong><code>r2R0</code></strong>: convert growth rate into a reproduction number</p></li>
<li><p><strong><code>lm2R0_sample</code></strong>: generates a distribution of R0 from a log-incidence linear model</p></li>
<li><p><strong><code>fit_disc_gamma</code></strong>: fits a discretised Gamma distribution to data (typically useful for describing delays)</p></li>
<li><p><strong><code>hash_names</code></strong>: generate unique, anonymised, reproducible labels from various data fields (e.g. First name, Last name, Date of birth).</p></li>
</ul>
</div>
<div id="fitting-a-gamma-distribution-to-delay-data" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-a-gamma-distribution-to-delay-data" class="anchor"></a>Fitting a gamma distribution to delay data</h1>
<p>In this example, we simulate data which replicate the serial interval (SI), i.e. the delays between primary and secondary symptom onsets, in Ebola Virus Disease (EVD). We start by converting previously estimates of the mean and standard deviation of the SI (WHO Ebola Response Team (2014) NEJM 371:1481–1495) to the parameters of a Gamma distribution:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(epitrix)

mu &lt;-<span class="st"> </span><span class="fl">15.3</span> <span class="co"># mean in days days</span>
sigma &lt;-<span class="st"> </span><span class="fl">9.3</span> <span class="co"># standard deviation in days</span>
cv &lt;-<span class="st"> </span>mu/sigma <span class="co"># coefficient of variation</span>
cv
<span class="co">#&gt; [1] 1.645161</span>
param &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gamma_tools.html">gamma_mucv2shapescale</a></span>(mu, cv) <span class="co"># convertion to Gamma parameters</span>
param
<span class="co">#&gt; $shape</span>
<span class="co">#&gt; [1] 0.3694733</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $scale</span>
<span class="co">#&gt; [1] 41.4103</span></code></pre></div>
<p>The <em>shape</em> and <em>scale</em> are parameters of a Gamma distribution we can use to generate delays. However, delays are typically reported per days, which implies a discretisation (from continuous time to discrete numbers). We use the package <a href="https://github.com/reconhub/distcrete"><em>distcrete</em></a> to achieve this discretisation. It generates a list of functions, including one to simulate data (<code>$r</code>), which we use to simulate 500 delays:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
si &lt;-<span class="st"> </span>distcrete::<span class="kw">distcrete</span>(<span class="st">"gamma"</span>, <span class="dt">interval =</span> <span class="dv">1</span>,
               <span class="dt">shape =</span> param$shape,
               <span class="dt">scale =</span> param$scale, <span class="dt">w =</span> <span class="dv">0</span>)
si
<span class="co">#&gt; A discrete distribution</span>
<span class="co">#&gt;   name: gamma</span>
<span class="co">#&gt;   parameters:</span>
<span class="co">#&gt;     shape: 0.369473279507882</span>
<span class="co">#&gt;     scale: 41.4103017689906</span>
<span class="kw">set.seed</span>(<span class="dv">1</span>)
x &lt;-<span class="st"> </span>si$<span class="kw">r</span>(<span class="dv">500</span>)
<span class="kw">head</span>(x, <span class="dv">10</span>)
<span class="co">#&gt;  [1]  0  2  7 46  0 43 62 12 10  0</span>
<span class="kw">hist</span>(x, <span class="dt">col =</span> <span class="st">"grey"</span>, <span class="dt">border =</span> <span class="st">"white"</span>,
     <span class="dt">xlab =</span> <span class="st">"Days between primary and secondary onset"</span>,
     <span class="dt">main =</span> <span class="st">"Simulated serial intervals"</span>)</code></pre></div>
<p><img src="figs-overview/si-1.png" width="672"></p>
<p><code>x</code> contains simulated data, for illustrative purpose. In practice, one would use real data from an ongoing outbreaks. Now we use <code>fit_disc_gamma</code> to estimate the parameters of a dicretised Gamma distribution from the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
si_fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fit_disc_gamma.html">fit_disc_gamma</a></span>(x)
si_fit
<span class="co">#&gt; $mu</span>
<span class="co">#&gt; [1] 15.01017</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $cv</span>
<span class="co">#&gt; [1] 1.656824</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $sd</span>
<span class="co">#&gt; [1] 24.8692</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ll</span>
<span class="co">#&gt; [1] -1689.073</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $converged</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $distribution</span>
<span class="co">#&gt; A discrete distribution</span>
<span class="co">#&gt;   name: gamma</span>
<span class="co">#&gt;   parameters:</span>
<span class="co">#&gt;     shape: 0.364290092380669</span>
<span class="co">#&gt;     scale: 41.2038799853595</span></code></pre></div>
</div>
<div id="converting-a-growth-rate-r-to-a-reproduction-number-r0" class="section level1">
<h1 class="hasAnchor">
<a href="#converting-a-growth-rate-r-to-a-reproduction-number-r0" class="anchor"></a>Converting a growth rate (r) to a reproduction number (R0)</h1>
<p>The package <a href="https://github.com/reconhub/incidence"><em>incidence</em></a> can fit a log-linear model to incidence curves (function <code>fit</code>), which produces a growth rate (r). This growth rate can in turn be translated into a basic reproduction number (R0) using <code>r2R0</code>. We illustrate this using simulated Ebola data from the <a href="https://github.com/reconhub/outbreaks"><em>outbreaks</em></a> package, and using the serial interval from the previous example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">library</span>(outbreaks)
<span class="kw">library</span>(incidence)
i &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/incidence/topics/incidence">incidence</a></span>(ebola_sim$linelist$date_of_onset)
i
<span class="co">#&gt; &lt;incidence object&gt;</span>
<span class="co">#&gt; [5888 cases from days 2014-04-07 to 2015-04-30]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $counts: matrix with 389 rows and 1 columns</span>
<span class="co">#&gt; $n: 5888 cases in total</span>
<span class="co">#&gt; $dates: 389 dates marking the left-side of bins</span>
<span class="co">#&gt; $interval: 1 day</span>
<span class="co">#&gt; $timespan: 389 days</span>
f &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/incidence/topics/fit">fit</a></span>(i[<span class="dv">1</span>:<span class="dv">150</span>]) <span class="co"># fit on first 150 days</span>
<span class="co">#&gt; Warning in fit(i[1:150]): 22 dates with incidence of 0 ignored for fitting</span>
<span class="kw">plot</span>(i[<span class="dv">1</span>:<span class="dv">200</span>], <span class="dt">fit =</span> f, <span class="dt">color =</span> <span class="st">"#9fc2fc"</span>)</code></pre></div>
<p><img src="figs-overview/fit_i-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="../reference/r2R0.html">r2R0</a></span>(f$info$r, si$<span class="kw">d</span>(<span class="dv">1</span>:<span class="dv">100</span>))
<span class="co">#&gt; [1] 1.358887</span>
<span class="kw"><a href="../reference/r2R0.html">r2R0</a></span>(f$info$r.conf, si$<span class="kw">d</span>(<span class="dv">1</span>:<span class="dv">100</span>))
<span class="co">#&gt;         2.5 %   97.5 %</span>
<span class="co">#&gt; [1,] 1.328372 1.388925</span></code></pre></div>
<p>In addition, we can also use the function <code>lm2R0_sample</code> to generate samples of R0 values compatible with a model fit:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
R0_val &lt;-<span class="st"> </span><span class="kw"><a href="../reference/r2R0.html">lm2R0_sample</a></span>(f$lm, si$<span class="kw">d</span>(<span class="dv">1</span>:<span class="dv">100</span>), <span class="dt">n =</span> <span class="dv">100</span>)
<span class="kw">head</span>(R0_val)
<span class="co">#&gt; [1] 1.360925 1.357800 1.360150 1.367461 1.352716 1.352790</span>
<span class="kw">hist</span>(R0_val, <span class="dt">col =</span> <span class="st">"grey"</span>, <span class="dt">border =</span> <span class="st">"white"</span>)</code></pre></div>
<p><img src="figs-overview/sample_R0-1.png" width="672"></p>
</div>
<div id="standardising-labels" class="section level1">
<h1 class="hasAnchor">
<a href="#standardising-labels" class="anchor"></a>Standardising labels</h1>
<p>If you want to use labels that will work across different computers, independent of local encoding and operating systems, <code>clean_labels</code> will make your life easier. The function transforms character strings by replacing diacritic symbols with their closest alphanumeric matches, setting all characters to lower case, and replacing various separators with a single, consistent one.</p>
<p>For instance:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> " Thîs- is A   wêïrD LäBeL .."</span>
x
<span class="co">#&gt; [1] " Thîs- is A   wêïrD LäBeL .."</span>
<span class="kw"><a href="../reference/clean_labels.html">clean_labels</a></span>(x)
<span class="co">#&gt; [1] "this_is_a_weird_label"</span>

variables &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Date.of.ONSET "</span>,
               <span class="st">"/  date of hôspitalisation  /"</span>,
               <span class="st">"-DäTÈ--OF___DîSCHARGE-"</span>,
               <span class="st">"GEndèr/"</span>,
               <span class="st">"  Location. "</span>)
variables
<span class="co">#&gt; [1] "Date.of.ONSET "                "/  date of hôspitalisation  /"</span>
<span class="co">#&gt; [3] "-DäTÈ--OF___DîSCHARGE-"        "GEndèr/"                      </span>
<span class="co">#&gt; [5] "  Location. "</span>
<span class="kw"><a href="../reference/clean_labels.html">clean_labels</a></span>(variables)
<span class="co">#&gt; [1] "date_of_onset"           "date_of_hospitalisation"</span>
<span class="co">#&gt; [3] "date_of_discharge"       "gender"                 </span>
<span class="co">#&gt; [5] "location"</span></code></pre></div>
</div>
<div id="anonymising-data" class="section level1">
<h1 class="hasAnchor">
<a href="#anonymising-data" class="anchor"></a>Anonymising data</h1>
<p><code>hash_names</code> can be used to generate hashed labels from linelist data. Based on pre-defined fields, it will generate anonymous labels. This system has the following desirable features:</p>
<ul>
<li><p>given the same input, the output will always be the same, so this encoding system generates labels which can be used by different people and organisations</p></li>
<li><p>given different inputs, the output will always be different; even minor differences in input will result in entirely different outputs</p></li>
<li><p>given an output, it is very hard to infer the input (it requires hacking skills); if security is challenged, the hashing algorithm can be ‘salted’ to strengthen security</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
first_name &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Jane"</span>, <span class="st">"Joe"</span>, <span class="st">"Raoul"</span>, <span class="st">"Raoul"</span>)
last_name &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Doe"</span>, <span class="st">"Smith"</span>, <span class="st">"Dupont"</span>, <span class="st">"Dupond"</span>)
age &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">69</span>, <span class="dv">36</span>, <span class="dv">36</span>)

## detailed output by default
<span class="kw"><a href="../reference/hash_names.html">hash_names</a></span>(first_name, last_name, age)
<span class="co">#&gt;             label hash_short                                     hash</span>
<span class="co">#&gt; 1     jane_doe_25     4ea703 4ea703cdc94049fc649cd152faa5beed02858d69</span>
<span class="co">#&gt; 2    joe_smith_69     c76ee2 c76ee26d66438710023bb256a644ba9db9c2f6be</span>
<span class="co">#&gt; 3 raoul_dupont_36     abdf0b abdf0bf7990ce5127b406ca16fc1edd659ff51b3</span>
<span class="co">#&gt; 4 raoul_dupond_36     783fc2 783fc2dc44b496c3afd3b4546e997aea63f1e0df</span>

## short labels for practical use
<span class="kw"><a href="../reference/hash_names.html">hash_names</a></span>(first_name, last_name, age,
           <span class="dt">size =</span> <span class="dv">8</span>, <span class="dt">full =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; [1] "4ea703cd" "c76ee26d" "abdf0bf7" "783fc2dc"</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#what-does-it-do">What does it do?</a></li>
      <li><a href="#fitting-a-gamma-distribution-to-delay-data">Fitting a gamma distribution to delay data</a></li>
      <li><a href="#converting-a-growth-rate-r-to-a-reproduction-number-r0">Converting a growth rate (r) to a reproduction number (R0)</a></li>
      <li><a href="#standardising-labels">Standardising labels</a></li>
      <li><a href="#anonymising-data">Anonymising data</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Thibaut Jombart, Anne Cori.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
