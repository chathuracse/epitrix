---
title: "Example to estimate incubation period"
author: "Flavio Finger"
date: "`r Sys.Date()`"
output:
   rmarkdown::html_vignette:
     toc: true
     toc_depth: 2
vignette: >
  %\VignetteIndexEntry{Estimating Incubation Period}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width=7,
  fig.height=5,
  fig.path="figs-overview/"
)
```


Example using toy data.

Load environment:

```{r, echo = TRUE, message=FALSE}
library(magrittr)
library(linelist)
library(epitrix)
library(distcrete)
library(ggplot2)
```

Make a linelist object with several possible exposure dates for each case:

```{r, echo = TRUE}
ll <- messy_data() %>% clean_data()

# exposures <- x$date_of_onset - round(rgamma(20, shape = 12, rate = 3))
# mkexposures <- function(x) x - round(rgamma(sample.int(5, size = 1), shape = 12, rate = 3))
x <- 0:15
y <- distcrete("gamma", 1, shape = 12, rate = 3, w = 0)$d(x)
mkexposures <- function(foo) foo - base::sample(x, size = sample.int(5, size = 1), prob = y)
exposures <- sapply(ll$date_of_onset, mkexposures)
ll$dates_exposure <- exposures

print(ll)
```

Empirical distribution:

```{r}
incubation_period_dist <- empirical_incubation_dist(ll, dates_exposure, date_of_onset)
print(incubation_period_dist)

ggplot(incubation_period_dist, aes(incubation_period, relative_frequency)) +
  geom_col()
```

Fit discrete gamma:

```{r}
fit <- fit_gamma_incubation_dist(ll, dates_exposure, date_of_onset)
print(fit)

x = c(0:10)
y = fit$distribution$d(x)
ggplot(data.frame(x=x, y=y), aes(x, y)) +
    geom_col(data = incubation_period_dist, aes(incubation_period, relative_frequency)) +
    geom_point(stat="identity", col = "red", size = 3) +
    geom_line(stat="identity", col = "red")
```
